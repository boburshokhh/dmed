# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MinIO

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

MinIO **–†–ê–ë–û–¢–ê–ï–¢** –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø—Ä–æ–µ–∫—Ç—É!

```
‚úì MinIO –≤–∫–ª—é—á–µ–Ω (MINIO_ENABLED: True)
‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
‚úì Bucket 'dmed' —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ MinIO –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cd /var/www/dmed
source .venv/bin/activate
python3 check_minio.py
```

## üì¶ –ú–∏–≥—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ MinIO

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `uploads/documents/`, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ MinIO:

```bash
cd /var/www/dmed
source .venv/bin/activate
python3 migrate_to_minio.py
```

–°–∫—Ä–∏–ø—Ç:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —É–∂–µ –≤ MinIO
- ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ MinIO
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏!
rm -rf /var/www/dmed/uploads/documents/*
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ MinIO

### –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å MinIO: `http://dmed.gubkin.uz:9001`
2. –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –û—Ç–∫—Ä–æ–π—Ç–µ bucket `dmed`
4. –£–≤–∏–¥–∏—Ç–µ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç

```python
from storage import storage_manager

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
files = storage_manager.list_files()
for f in files:
    print(f"{f['name']} - {f['size']} –±–∞–π—Ç")
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MinIO

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
MINIO_ENABLED=True
MINIO_ENDPOINT=http://dmed.gubkin.uz:9000
MINIO_ACCESS_KEY=your_access_key
MINIO_SECRET_KEY=your_secret_key
MINIO_SECURE=False
MINIO_BUCKET_NAME=dmed
```

### –í–∞–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã MinIO

- **9000** - API –ø–æ—Ä—Ç (–¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- **9001** - Console –ø–æ—Ä—Ç (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞

```bash
# –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö MinIO
du -sh /var/lib/minio

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –≤ bucket
python3 -c "
from storage import storage_manager
files = storage_manager.list_files()
print(f'–§–∞–π–ª–æ–≤: {len(files)}')
print(f'–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: {sum(f[\"size\"] for f in files) / 1024 / 1024:.2f} MB')
"
```

### –õ–æ–≥–∏ MinIO

```bash
# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ MinIO
sudo journalctl -u minio -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
sudo journalctl -u minio -n 50
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### MinIO –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MinIO –∑–∞–ø—É—â–µ–Ω:
   ```bash
   sudo systemctl status minio
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞:
   ```bash
   curl http://localhost:9000/minio/health/live
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   sudo journalctl -u minio | tail -50
   ```

### –û—à–∏–±–∫–∞ "Access Denied"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Access Key –∏ Secret Key –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –∫–ª—é—á–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ bucket `dmed`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ MinIO (–ø–æ—Ä—Ç 9001)

### –§–∞–π–ª—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ MinIO

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `MINIO_ENABLED=True` –≤ `.env`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   sudo systemctl restart dmed
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```bash
   sudo journalctl -u dmed | grep -i minio
   ```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MinIO** (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `minioadmin`)
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è MinIO –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (`MINIO_SECURE=True`)
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –ø–æ—Ä—Ç—É 9001 (–∫–æ–Ω—Å–æ–ª—å) —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** –¥–∞–Ω–Ω—ã—Ö MinIO

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Å–æ–ª–∏
sudo ufw allow from 127.0.0.1 to any port 9001
sudo ufw allow 9000/tcp
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (`uploads/documents`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback –µ—Å–ª–∏ MinIO –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ MinIO –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω
- **–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã** –æ—Å—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- **–ú–∏–≥—Ä–∞—Ü–∏—è** –Ω–µ —É–¥–∞–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ MinIO
python3 check_minio.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å MinIO
# http://dmed.gubkin.uz:9001
```

