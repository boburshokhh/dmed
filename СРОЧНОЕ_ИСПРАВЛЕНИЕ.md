# Срочное исправление ошибки QR-кода

## Проблема
В логах видна ошибка:
```
[WARNING] qrcode-styled не установлен (No module named 'qrcode_styled'), используем обычный qrcode
[QR_PIN_LAYOUT] QR-код сгенерирован, размер: None
[ERROR] Ошибка при добавлении QR-кода: 'NoneType' object has no attribute 'save'
```

## Решение

### Шаг 1: Обновите код (уже исправлен в репозитории)

```bash
cd /var/www/dmed
git pull
```

### Шаг 2: Установите библиотеку qrcode-styled

```bash
    source venv/bin/activate
pip install qrcode-styled>=0.2.0
```

Или установите все зависимости:
```bash
pip install -r requirements.txt
```

### Шаг 3: Перезапустите приложение

```bash
sudo systemctl restart dmed
```

### Шаг 4: Проверьте логи

```bash
sudo journalctl -u dmed -f
```

Теперь должны появиться сообщения:
```
[QR_CODE] Используем fallback: обычный qrcode
[QR_CODE] Базовый QR-код создан, размер: (290, 290)
[QR_CODE] Финальный QR-код (fallback): размер (290, 290), режим RGBA
```

## Альтернатива: Если не хотите устанавливать qrcode-styled

Код уже исправлен - теперь fallback работает правильно даже без qrcode-styled. Просто:

1. Обновите код: `git pull`
2. Перезапустите: `sudo systemctl restart dmed`

QR-код будет генерироваться через обычную библиотеку `qrcode` (без стиля, но работает).

## Проверка

После перезапуска создайте тестовый документ и проверьте:
- QR-код должен генерироваться без ошибок
- PIN-код должен быть слева от QR-кода
- В логах не должно быть ошибок `'NoneType' object has no attribute 'save'`

