# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ QR-–∫–æ–¥–∞ –Ω–∞ Ubuntu —Å–µ—Ä–≤–µ—Ä–µ

## üîç –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
cd /var/www/dmed
chmod +x check_qr_logs.sh
sudo bash check_qr_logs.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –ª–æ–≥–∏ systemd
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ù–∞–π–¥—ë—Ç –æ—à–∏–±–∫–∏
- –ü–æ–∫–∞–∂–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

---

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ systemd (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ systemd)

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
sudo journalctl -u dmed -n 100

# –õ–æ–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ QR-–∫–æ–¥—É
sudo journalctl -u dmed -n 200 | grep -i -E "(qr|QR|error|ERROR)"

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ–∫–∞ —Å–æ–∑–¥–∞—ë—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç)
sudo journalctl -u dmed -f
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –≤—Ä—É—á–Ω—É—é)

```bash
cd /var/www/dmed

# –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª –ª–æ–≥–æ–≤
tail -100 app.log | grep -i qr

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

#### 3. –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ –Ω–∞–ø—Ä—è–º—É—é

```bash
cd /var/www/dmed
source venv/bin/activate

python3 << 'EOF'
import sys
import traceback

print("=== –¢–ï–°–¢ –ì–ï–ù–ï–†–ê–¶–ò–ò QR-–ö–û–î–ê ===")

# –¢–µ—Å—Ç 1: –ò–º–ø–æ—Ä—Ç
try:
    from qrcode_styled import QRCodeStyled
    from PIL import Image
    print("‚úì –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã")
except Exception as e:
    print(f"‚úó –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    traceback.print_exc()
    sys.exit(1)

# –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ QR-–∫–æ–¥–∞
try:
    qr = QRCodeStyled()
    img = qr.get_image('test')
    print(f"‚úì QR-–∫–æ–¥ —Å–æ–∑–¥–∞–Ω: {type(img)}, —Ä–∞–∑–º–µ—Ä: {img.size}")
except Exception as e:
    print(f"‚úó –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞: {e}")
    traceback.print_exc()
    sys.exit(1)

# –¢–µ—Å—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ utils
try:
    from utils import generate_qr_code
    img = generate_qr_code('https://test.example.com')
    print(f"‚úì generate_qr_code —Ä–∞–±–æ—Ç–∞–µ—Ç: —Ä–∞–∑–º–µ—Ä {img.size}, —Ä–µ–∂–∏–º {img.mode}")
except Exception as e:
    print(f"‚úó –û—à–∏–±–∫–∞ –≤ generate_qr_code: {e}")
    traceback.print_exc()
    sys.exit(1)

print("\n‚úì –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
EOF
```

---

## üîé –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö

### –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞:
```
[QR_CODE] –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é QR-–∫–æ–¥–∞ –¥–ª—è URL: https://...
[QR_CODE] –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É qrcode-styled
[QR_CODE] –õ–æ–≥–æ—Ç–∏–ø —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: (200, 200), —Ä–µ–∂–∏–º: RGBA
[QR_CODE] QR-–∫–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ qrcode-styled
[QR_CODE] –§–∏–Ω–∞–ª—å–Ω—ã–π QR-–∫–æ–¥: —Ä–∞–∑–º–µ—Ä (1248, 1248), —Ä–µ–∂–∏–º RGBA
```

### –û—à–∏–±–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ:

1. **–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:**
   ```
   ModuleNotFoundError: No module named 'qrcode_styled'
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≤ venv

2. **–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞:**
   ```
   [ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ qr.get_image()
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

3. **–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   ```
   [ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π PilStyledImage

4. **–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
   ```
   [ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ QR-–∫–æ–¥–∞
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ

---

## üõ†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: QR-–∫–æ–¥ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
cd /var/www/dmed
source venv/bin/activate
python3 -c "from document_generator import add_qr_code_to_docx; print('OK')"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ "PilStyledImage –Ω–µ –∏–º–µ–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–∞..."

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ utils.py (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
sudo journalctl -u dmed -n 200 | grep -i "QR_PIN_LAYOUT"
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
```
[QR_PIN_LAYOUT] ===== –ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è QR-–∫–æ–¥–∞ –∏ PIN-–∫–æ–¥–∞ =====
[QR_PIN_LAYOUT] QR-–∫–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ venv
- [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- [ ] –§—É–Ω–∫—Ü–∏—è `generate_qr_code` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
- [ ] QR-–∫–æ–¥ —Å–æ–∑–¥–∞—ë—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–æ–º)
- [ ] QR-–∫–æ–¥ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ª–æ–≥–∞–º–∏)
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ uploads/documents

---

## üì§ –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ:**
1. –í–µ—Å—å –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ `check_qr_logs.sh`
2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏:
   ```bash
   sudo journalctl -u dmed -n 200 | grep -i -E "(qr|error|exception)"
   ```
3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞

–° —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π —è —Å–º–æ–≥—É —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—ë!

